gwtd() {
  local toplevel
  toplevel=$(git rev-parse --show-toplevel) || return 1

  # Ensure we are actually in a worktree (containing '--')
  if [[ ! "$(basename "$toplevel")" == *--* ]]; then
    echo "Error: Not currently inside a generated worktree."
    return 1
  fi

  local base_dir="${toplevel%--*}"

  # Move to the base directory before removal to avoid 'directory in use' errors
  cd "$base_dir" || return 1

  # Remove the worktree and the associated branch
  git worktree remove "$toplevel"
}